function feedbackMessage(e,o,t){o="undefined"!=typeof o?o:"info",t="undefined"!=typeof t?t:".message-box";var n='<div class="alert alert-'+o+'">'+e+"</div>",a=$(t).first();a.fadeIn("fast"),a.append(n),clearTimeout(messageTimer),messageTimer=setTimeout(clearMessages,6e3,t)}function clearMessages(e){var o=$(e).first();o.fadeOut("slow",function(){o.html("")})}function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"en"},"google_translate_element")}Annotator.Plugin.Madison=function(){Annotator.Plugin.apply(this,arguments)},$.extend(Annotator.Plugin.Madison.prototype,new Annotator.Plugin,{events:{},options:{},pluginInit:function(){this.annotator.subscribe("annotationsLoaded",function(e){e.forEach(function(e){e.highlights.forEach(function(o){$(o).attr("id","annotation_"+e.id),$(o).attr("name","annotation_"+e.id),e.link="annotation_"+e.id})});var o=getAnnotationService();o.setAnnotations(e)}),this.annotator.subscribe("annotationCreated",function(e){var o=getAnnotationService();o.addAnnotation(e),$.showAnnotationThanks&&$("#annotationThanks").modal({remote:_baseUrl+"/modals/annotation_thanks",keyboard:!0})}),this.annotator.subscribe("commentCreated",function(e){e=$('<div class="existing-comment"><blockquote>'+e.text+'<div class="comment-author">'+e.user.name+"</div></blockquote></div>");var o=$("#current-comments");o.append(e),o.removeClass("hidden"),$("#current-comments").collapse(!0)}),this.annotator.subscribe("annotationViewerTextField",function(e,o){if(0!==o.tags.length){o.tags.forEach(function(t){if("editar"===t){var n=$(e),a=new diff_match_patch,r=a.diff_main(o.quote,o.text),s=a.diff_prettyHtml(r);n.find("p").html(s)}})}}),this.annotator.viewer.addField({load:function(e,o){this.addNoteLink(e,o),this.addNoteActions(e,o),this.addComments(e,o)}.bind(this)}),this.annotator.editor.submit=function(e){this.annotation._error=!1;var o,t,n,a;for(Annotator.Util.preventEventDefault(e),a=this.fields,t=0,n=a.length;n>t;t++)o=a[t],o.submit(o.element,this.annotation);return this.annotation._error!==!0?(this.publish("save",[this.annotation]),this.hide()):void 0},this.annotator.editor.addField({load:function(e,o){this.addEditFields(e,o)}.bind(this),submit:function(e,o){if(this.hasEditTag(o.tags)){var t=$(e).find("#explanation").val();if(""==t.trim())return $("#annotation-error").text("Por favor explica por qué hiciste el cambio.").toggle(!0),o._error=!0,!1;o.explanation=t}},hasEditTag:function(e){var o=!1;return void 0===e||0===e.length?!1:(e.forEach(function(e){"editar"===e&&(o=!0)}),o)}})},addEditFields:function(e,o){var t=$(e),n=$('<div class="annotator-editor-edit-wrapper"></div>'),a=$('<div class="btn-group"></div>'),r=$('<input id="explanation" type="text" name="explanation" placeholder="¿Por qué editaste esto?" style="display:none;" />'),s=$('<p id="annotation-error" style="display:none; color:red;"></p>'),i=$('<button type="button" class="btn btn-default active">Anotar</button>').click(function(){$(this).addClass("active"),$(this).siblings().each(function(e){$(this).removeClass("active")}),$("#annotator-field-0").val(""),$("#annotator-field-1").val(""),$("#explanation").toggle(!1),$("#explanation").prop("required",!1),$("#annotator-error").text("").toggle(!1),$("#annotator-field-0").focus()}),c=$('<button type="button" class="btn btn-default">Editar</button>').click(function(){$(this).addClass("active"),$(this).siblings().each(function(e){$(this).removeClass("active")}),$("#annotator-field-0").val(o.quote),$("#annotator-field-1").val("editar"),$("#explanation").toggle(!0),$("#explanation").prop("required",!0),$("#annotator-field-0").focus()});a.append(i,c),n.append(a),n.append(r),n.append(s),t.html(n)},addComments:function(e,o){var t=$('<div class="comment-toggle" data-toggle-"collapse" data-target="#current-comments">Comentarios <span id="comment-caret" class="caret caret-right"></span></button>').click(function(){$("#current-comments").collapse("toggle"),$("#comment-caret").toggleClass("caret-right")});0===$(o.comments).length&&t.addClass("hidden");var n=$('<div id="current-comments" class="current-comments collapse"></div>');if($.each(o.comments,function(e,o){o=$('<div class="existing-comment"><blockquote>'+o.text+'<div class="comment-author">'+o.user.name+"</div></blockquote></div>"),n.append(o)}),n.ready(function(){$("#existing-comments").collapse({toggle:!1})}),""!==user.id){var a=$('<div class="annotation-comments"></div>'),r=$('<input type="text" class="form-control" />'),s=$('<button type="button" class="btn btn-primary" >Enviar</button>');s.click(function(){this.createComment(r,o)}.bind(this)),a.append(r),a.append(s),$(e).append(a)}$(e).append(t,n)},addNoteActions:function(e,o){var t=$("<div></div>").addClass("annotation-action"),n=$("<span></span>").addClass("glyphicon").data("annotation-id",o.id),a=n.clone().addClass("glyphicon-thumbs-up").append('<span class="action-count">'+o.likes+"</span>"),r=n.clone().addClass("glyphicon-thumbs-down").append('<span class="action-count">'+o.dislikes+"</span>"),s=n.clone().addClass("glyphicon-flag").append('<span class="action-count">'+o.flags+"</span>");if(t.append(a,r,s),""!==user.id){o.user_action&&("like"===o.user_action?a.addClass("selected"):"dislike"===o.user_action?r.addClass("selected"):"flag"===o.user_action&&s.addClass("selected"));var i=this;a.addClass("logged-in").click(function(){i.addLike(o,this)}),r.addClass("logged-in").click(function(){i.addDislike(o,this)}),s.addClass("logged-in").click(function(){i.addFlag(o,this)})}$(e).append(t)},addNoteLink:function(e,o){var t=$('<div class="annotation-link"></div>'),n=window.location.origin+window.location.pathname+"#"+o.link,a=$("<a></a>").attr("href",window.location.pathname+"#"+o.link).text("Copiar Enlace de Anotación").addClass("annotation-permalink");a.attr("data-clipboard-text",n);new ZeroClipboard(a);t.append(a),$(e).append(t)},createComment:function(e,o){var t=e.val();e.val("");var n={text:t,user:user};$.post(_baseUrl+"/api/docs/"+doc.id+"/annotations/"+o.id+"/comments",{comment:n},function(){return o.comments.push(n),this.annotator.publish("commentCreated",n)}.bind(this))},addLike:function(e,o){$.post(_baseUrl+"/api/docs/"+doc.id+"/annotations/"+e.id+"/likes",function(t){o=$(o),o.children(".action-count").text(t.likes),o.siblings(".glyphicon").removeClass("selected"),t.action?o.addClass("selected"):o.removeClass("selected"),o.siblings(".glyphicon-thumbs-up").children(".action-count").text(t.likes),o.siblings(".glyphicon-thumbs-down").children(".action-count").text(t.dislikes),o.siblings(".glyphicon-flag").children(".action-count").text(t.flags),e.likes=t.likes,e.dislikes=t.dislikes,e.flags=t.flags,e.user_action="like"})},addDislike:function(e,o){$.post(_baseUrl+"/api/docs/"+doc.id+"/annotations/"+e.id+"/dislikes",function(t){o=$(o),o.children(".action-count").text(t.dislikes),o.siblings(".glyphicon").removeClass("selected"),t.action?o.addClass("selected"):o.removeClass("selected"),o.siblings(".glyphicon-thumbs-up").children(".action-count").text(t.likes),o.siblings(".glyphicon-thumbs-down").children(".action-count").text(t.dislikes),o.siblings(".glyphicon-flag").children(".action-count").text(t.flags),e.likes=t.likes,e.dislikes=t.dislikes,e.flags=t.flags,e.user_action="dislike"})},addFlag:function(e,o){$.post(_baseUrl+"/api/docs/"+doc.id+"/annotations/"+e.id+"/flags",function(t){o=$(o),o.children(".action-count").text(t.flags),o.siblings(".glyphicon").removeClass("selected"),t.action?o.addClass("selected"):o.removeClass("selected"),o.siblings(".glyphicon-thumbs-up").children(".action-count").text(t.likes),o.siblings(".glyphicon-thumbs-down ").children(".action-count").text(t.dislikes),e.likes=t.likes,e.dislikes=t.dislikes,e.flags=t.flags,e.user_action="flag"})}}),angular.module("madisonApp.controllers",[]),angular.module("madisonApp.controllers").controller("AnnotationController",["$scope","$sce","$http","annotationService","createLoginPopup","growl","$location","$filter","$timeout",function(e,o,t,n,a,r,s,i,c){e.annotations=[],e.supported=null,e.opposed=!1;var u=s.hash(),l=u.match(/^annsubcomment_([0-9]+)$/);l&&(e.subCommentId=l[1]),e.$on("annotationsUpdated",function(){angular.forEach(n.annotations,function(o){if($.inArray(o,e.annotations)<0){var t=!0;e.subCommentId&&angular.forEach(o.comments,function(o){o.id==e.subCommentId&&(t=!1)}),o.label="annotation",o.commentsCollapsed=t,e.annotations.push(o)}}),e.$apply()}),e.init=function(o){e.user=user,e.doc=doc},e.isSponsor=function(){var o=e.user.id,t=!1;return angular.forEach(e.doc.sponsor,function(e){o===e.id&&(t=!0)}),t},e.notifyAuthor=function(e){t.post("/api/docs/"+doc.id+"/annotations/"+e.id+"/seen").success(function(o){e.seen=o.seen}).error(function(e){console.error("Unable to mark activity as seen: %o",e)})},e.getDocComments=function(o){t({method:"GET",url:"/api/docs/"+o+"/comments"}).success(function(o){angular.forEach(o,function(o){var t=!1;e.subCommentId&&angular.forEach(o.comments,function(o){o.id==e.subCommentId&&(t=!1)}),o.commentsCollapsed=t,o.label="comment",o.link="comment_"+o.id,e.annotations.push(o)})}).error(function(e){console.error("Error loading comments: %o",e)})},e.commentSubmit=function(){var o=angular.copy(e.comment);o.user=e.user,o.doc=e.doc,t.post("/api/docs/"+o.doc.id+"/comments",{comment:o}).success(function(){o.label="comment",o.user.fname=o.user.name,e.stream.push(o),e.comment.text="",feedbackMessage("<b>¡Gracias!</b> Acabas de agregar un comentario","success","#participate-activity-message")}).error(function(e){console.error("Error posting comment: %o",e)})},e.activityOrder=function(e){var o=e.likes-e.dislikes;return o},e.addAction=function(o,n,r){""!==e.user.id?t.post("/api/docs/"+e.doc.id+"/"+o.label+"s/"+o.id+"/"+n).success(function(e){o.likes=e.likes,o.dislikes=e.dislikes,o.flags=e.flags}).error(function(e){console.error(e)}):a(r)},e.collapseComments=function(e){e.commentsCollapsed=!e.commentsCollapsed},e.subcommentSubmit=function(o,t){if(""===e.user.id){var n=document.activeElement;return document.activeElement==document.body?(pageY=$(window).scrollTop()+300,clientX=$(window).width()/2-100):(pageY=$(n).offset().top,clientX=$(n).offset().left),void a(jQuery.Event("click",{clientX:clientX,pageY:pageY}))}t.user=e.user,$.post(_baseUrl+"/api/docs/"+e.doc.id+"/"+o.label+"s/"+o.id+"/comments",{comment:t}).success(function(n){o.comments.push(n),t.text="",t.user="",e.$apply(),feedbackMessage("<b>¡Gracias!</b> Acabas de agregar un comentario","success","#participate-activity-message")}).error(function(e){console.error(e)})}}]),angular.module("madisonApp.controllers").controller("AppController",["$rootScope","$scope","UserService",function(e,o,t){e.$on("$routeChangeSuccess",function(o,t,n){e.pageTitle=t.$$route.title}),o.$on("userUpdated",function(){o.user=t.user}),t.getUser()}]),angular.module("madisonApp.controllers").controller("CommentController",["$scope","$sce","$http","annotationService","createLoginPopup","growl","$location","$filter","$timeout",function(e,o,t,n,a,r,s,i,c){e.comments=[],e.supported=null,e.opposed=!1,e.collapsed_comment={};var u=s.hash(),l=u.match(/(sub)?comment_([0-9]+)$/);l&&(e.subCommentId=l[2]),e.init=function(o,t,n){e.getDocComments(o),e.user=user,e.doc=doc,e.disableAuthor="undefined"!=typeof t,e.disableCommentAction="undefined"!=typeof n,e.getLayoutTexts()},e.isSponsor=function(o){var t=o||e.user.id,n=!1;return angular.forEach(e.doc.sponsor,function(e){t===e.id&&(n=!0)}),n},e.notifyAuthor=function(e){t.post(_baseUrl+"/api/docs/"+doc.id+"/comments/"+e.id+"/seen").success(function(o){e.seen=o.seen}).error(function(e){console.error("Unable to mark activity as seen: %o",e)})},e.getLayoutTexts=function(){var o={common:{header:"",callToAction:"",commentLabel:"Agrega un comentario:",commentPlaceholder:"Agregar un comentario",subCommentPlaceholder:"Agregar un comentario",commentfeedbackMessage:"<b>¡Gracias!</b> Acabas de agregar un comentario",subCommentfeedbackMessage:"<b>¡Gracias!</b> Acabas de agregar un comentario",privateComment:"Comentario privado",sendComment:"Enviar"},ieda:{header:"Categorías de Datos Abiertos propuestos",callToAction:"Vota por los conjuntos de datos que te interesan",commentLabel:"Sugiere otra categoría:",commentPlaceholder:"Sugiere otra categoría",subCommentPlaceholder:"Sugiere otro conjunto",commentfeedbackMessage:"<b>¡Gracias!</b> Acabas de sugerir una categoría",subCommentfeedbackMessage:"<b>¡Gracias!</b> Acabas de sugerir un conjunto de datos",privateComment:"Categoría privada",sendComment:"Enviar"},planAGA:{header:"Temas para el Tercer Plan de Acción de la Alianza para el Gobierno Abierto",callToAction:"Vota y comenta los temas que más te interesan.",commentLabel:"Sugiere otro tema:",commentPlaceholder:"Sugiere otro tema",subCommentPlaceholder:"Sugiere otro subtema",commentfeedbackMessage:"<b>¡Gracias!</b> Acabas de sugerir un tema",subCommentfeedbackMessage:"<b>¡Gracias!</b> Acabas de sugerir un subtema",privateComment:"Tema privado",sendComment:"Enviar"},cofemer:{header:"",callToAction:"",commentLabel:"Agrega tu comentario:",commentPlaceholder:"Agrega tu comentario",subCommentPlaceholder:"Agrega tu comentario",commentfeedbackMessage:"<b>¡Gracias!</b> Acabas de agregar un comentario",subCommentfeedbackMessage:"<b>¡Gracias!</b> Acabas de agregar un comentario",privateComment:"Comentario privado",sendComment:"Enviar"}};e.layoutTexts=o.common,angular.forEach(e.doc.doc_layouts,function(t){void 0!==o[t.name]&&(e.layoutTexts=o[t.name])})},e.getDocComments=function(o){t({method:"GET",url:_baseUrl+"/api/docs/"+o+"/comments"}).success(function(o){if(angular.forEach(o,function(t){if(null!==t.parent_id){var n=e.parentSearch(o,t.parent_id);t.parentpointer=o[n],o[n].comments.push(t)}t.id==e.subCommentId&&(e.collapsed_comment=t),t.commentsCollapsed=!0,t.label="comment",t.link="comment_"+t.id,null===t.parent_id&&e.comments.push(t)}),e.subCommentId){var t=!0;do e.collapsed_comment.commentsCollapsed=!1,null!==e.collapsed_comment.parent_id?e.collapsed_comment=e.collapsed_comment.parentpointer:t=!1;while(t===!0)}}).error(function(e){console.error("Error loading comments: %o",e)})},e.parentSearch=function(e,o){for(var t=0;t<e.length;t++)if(e[t].id===o)return t;return!1},e.commentSubmit=function(){var o=angular.copy(e.comment);o.user=e.user,o.doc=e.doc,t.post(_baseUrl+"/api/docs/"+o.doc.id+"/comments",{comment:o}).success(function(o){o[0].label="comment",e.comments.push(o[0]),e.comment.text="",feedbackMessage(e.layoutTexts.commentfeedbackMessage,"success","#participate-comment-message")}).error(function(e){console.error("Error posting comment: %o",e)})},e.activityOrder=function(e){var o=e.likes-e.dislikes;return o},e.addAction=function(o,n,r){""!==e.user.id?t.post(_baseUrl+"/api/docs/"+e.doc.id+"/"+o.label+"s/"+o.id+"/"+n).success(function(e){o.likes=e.likes,o.dislikes=e.dislikes,o.flags=e.flags,o.deleted_at=e.deleted_at}).error(function(e){console.error(e)}):a(r)},e.collapseComments=function(e){e.commentsCollapsed=!e.commentsCollapsed},e.subcommentSubmit=function(o,t){if(""===e.user.id){var n=document.activeElement;return document.activeElement==document.body?(pageY=$(window).scrollTop()+300,clientX=$(window).width()/2-100):(pageY=$(n).offset().top,clientX=$(n).offset().left),void a(jQuery.Event("click",{clientX:clientX,pageY:pageY}))}t.user=e.user,$.post(_baseUrl+"/api/docs/"+e.doc.id+"/"+o.label+"s/"+o.id+"/comments",{comment:t}).success(function(n){n.comments=[],n.label="comment",o.comments.push(n),t.text="",t.user="",e.$apply(),feedbackMessage(e.layoutTexts.subCommentfeedbackMessage,"success","#participate-comment-message")}).error(function(e){console.error(e)})}}]),angular.module("madisonApp.controllers").controller("DocumentPageController",["$scope","$cookies","$location","Doc","$sce",function(e,o,t,n,a){e.hideIntro=o.hideIntro;var r=t.hash().match(/^annsubcomment_([0-9]+)$/);e.secondtab=!1,!r&&t.hash()&&(e.secondtab=!0),e.hideHowToAnnotate=function(){o.hideIntro=!0,e.hideIntro=!0},e.doc=n.get({id:doc.id},function(){if(void 0!==e.doc.introtext[0]){var o=new Markdown.Converter;e.introtext=a.trustAsHtml(o.makeHtml(e.doc.introtext[0].meta_value))}})}]),angular.module("madisonApp.controllers").controller("DocumentTocController",["$scope",function(e){e.headings=[];var o=$("#doc_content").find("h1,h2,h3,h4,h5,h6");if(o.length>0)o.each(function(o,t){t=$(t),t.attr("id")||t.attr("id","heading-"+o),t.addClass("anchor"),e.headings.push({title:t.text(),tag:t.prop("tagName"),link:t.attr("id")})});else{$("#toc-column").remove();var t=$("#content").parent();t.removeClass("col-md-6"),t.addClass("col-md-9")}}]),angular.module("madisonApp.controllers").controller("EmailSubscribeController",["$scope","$http",function(e,o){e.email="",e.successMessage=!1,e.subscribeEmail=function(){o.post("http://www.gob.mx/subscribe",{email:e.email}).success(function(o){e.successMessage=!0}).error(function(e){console.error("Unable to mark activity as seen: %o",e)})}}]),angular.module("madisonApp.controllers").controller("HomePageController",["$scope","$location","$http","$filter","$cookies","Doc",function(e,o,t,n,a,r){var s=$(".main-banner"),i=o.search(),c=i.page?i.page:1,u=i.limit?i.limit:20,l=i.q?i.q:"";docFilter=i.mode?i.mode:"",docOrder=i.date?i.date:"";var d=function(){e.docs=Array(),e.updating=!0;var o={q:l,filter:docFilter,order:docOrder,page:c,per_page:u};o=_.pick(o,function(e,o,t){return""!==e}),r.query(o,function(o){e.totalDocs=o.pagination.count,e.perPage=o.pagination.per_page,e.page=o.pagination.page,e.updating=!1,e.docs=o.results}).$promise["catch"](function(e){console.error("Unable to get documents: %o",e)})};$(function(){$("#home-select2-filter").select2({placeholder:"Categoría, autor o estatus",allowClear:!0}),$("#home-select2-order").select2({placeholder:"Fecha",allowClear:!0})}),e.docs=[],e.reverse=!0,e.startStep=0,e.updating=!1,e.docSearch=l,e.docFilter=docFilter,e.docOrder=docOrder,e.paginate=function(){e.page>1?o.search("page",e.page):o.search("page",null),c=e.page,$("html, body").animate({scrollTop:s.offset().top+s.height()},500),d()},e.search=function(){e.docSearch?o.search("q",e.docSearch):o.search("q",null),e.docFilter?o.search("filter",e.docFilter):o.search("filter",null),e.docOrder?o.search("order",e.docOrder):o.search("order",null),l=e.docSearch,docFilter=e.docFilter,docOrder=e.docOrder,d()},d()}]),angular.module("madisonApp.controllers").controller("ReaderController",["$scope","$http","annotationService","createLoginPopup","$timeout","$anchorScroll",function(e,o,t,n,a,r){var s=function(e){return 1==e?"":"n"},i=function(e,o){var t=o?" apoya":" se opone";return e+t+s(e)};e.annotations=[],e.$on("annotationsUpdated",function(){e.annotations=t.annotations,e.$apply(),a(function(){r()},0)}),e.init=function(){e.user=user,e.doc=doc,e.getSupported(),e.doc.created_at=Date.parse(e.doc.created_at.replace(" ","T")),e.doc.updated_at=Date.parse(e.doc.updated_at.replace(" ","T"))},e.setSponsor=function(){try{0!==e.doc.group_sponsor.length?e.doc.sponsor=e.doc.group_sponsor:(e.doc.sponsor=e.doc.user_sponsor,e.doc.sponsor[0].display_name=e.doc.sponsor[0].fname+" "+e.doc.sponsor[0].lname)}catch(o){console.error(o)}},e.getSupported=function(){""!==e.user.id&&o.get(_baseUrl+"/api/users/support/"+e.doc.id).success(function(o){switch(o.support){case"1":e.supported=!0;break;case"":e.opposed=!0;break;default:e.supported=null,e.opposed=null}null!==e.supported&&null!==e.opposed&&($("#doc-support").text(i(o.supports,!0)),$("#doc-oppose").text(i(o.opposes,!1)))}).error(function(){console.error("Unable to get support info for user %o and doc %o",e.user,e.doc)})},e.support=function(t,a){""===e.user.id?n(a):o.post(_baseUrl+"/api/users/support/"+e.doc.id,{support:t}).success(function(o){null===o.support?(e.supported=!1,e.opposed=!1):(e.supported=o.support,e.opposed=!o.support);var t=$(a.target),n=$(a.target).siblings("a.btn");t.hasClass("doc-support")?(t.text(i(o.supports,!0)),n.text(i(o.opposes,!1))):(t.text(i(o.opposes,!1)),n.text(i(o.supports,!0)))}).error(function(e){console.error("Error posting support: %o",e)})},$(document).ready(function(){function e(){$("html").on("click.popup",function(){$(".popup").remove(),$("html").off("click.popup")})}function o(e,o){var t=$(e);t.submit(function(e){e.preventDefault(),$.post(t.attr("action"),t.serialize(),function(e){if(e.errors&&Object.keys(e.errors).length){var n=$("<ul></ul>");angular.forEach(e.errors,function(e,o){n.append("<li>"+e+"</li>")}),t.find(".errors").html(n)}else o(e)})})}var t,n;$(".affix-elm").each(function(e,o){o=$(o);var t=0;o.data("offset-top")&&(t=o.data("offset-top"));var n=0;o.data("offset-bottom")&&(n=o.data("offset-bottom")),o.affix({offset:{top:t,bottom:n}})}),""===user.id&&(Annotator.prototype.checkForEndSelection=function(t){var a,r,s,i,c;if(this.mouseIsDown=!1,!this.ignoreMouseup&&!$(".popup").length){for(this.selectedRanges=this.getSelectedRanges(),c=this.selectedRanges,s=0,i=c.length;i>s;s++)if(r=c[s],a=r.commonAncestor,$(a).hasClass("annotator-hl")&&(a=$(a).parents("[class!=annotator-hl]")[0]),this.isAnnotator(a))return;if(t&&this.selectedRanges.length){null!==t&&t.preventDefault(),n=$('<div class="popup unauthed-popup"><p>Ingresa para comentar.</p><input type="button" id="login" value="Ingresar" class="btn btn-primary"/><input type="button" id="signup" value="Registrarse" class="btn btn-primary" /></div>'),n.on("click.popup",function(e){e.stopPropagation()}),$("#login",n).click(function(e){e.stopPropagation(),e.preventDefault(),$.get(_baseUrl+"/api/auth/login",{},function(e){e=$(e),o(e.find("form"),function(){$("html").trigger("click.popup"),location.reload(!1)}),n.html(e)})}),$("#signup",n).click(function(e){e.stopPropagation(),e.preventDefault(),$.get(_baseUrl+"/api/auth/signup",{},function(e){e=$(e),o(e.find("form"),function(e){$("html").trigger("click.popup"),alert(e.message)}),n.html(e)})}),$("body").append(n);var u={top:t.pageY-n.height(),left:t.clientX};n.css(u).css("position","absolute"),this.ignoreMouseup=!1,setTimeout(e,50)}}}),t=$("#doc_content").annotator({}),t.annotator("addPlugin","Unsupported"),t.annotator("addPlugin","Tags"),t.annotator("addPlugin","Markdown"),t.annotator("addPlugin","Store",{annotationData:{uri:window.location.pathname,comments:[]},prefix:_baseUrl+"/api/docs/"+doc.id+"/annotations",urls:{create:"",read:"/:id",update:"/:id",destroy:"/:id",search:"/search"}}),t.annotator("addPlugin","Permissions",{user:user,permissions:{read:[],update:[user.id],"delete":[user.id],admin:[user.id]},showViewPermissionsCheckbox:!1,showEditPermissionsCheckbox:!1,userId:function(e){return e&&e.id?e.id:e},userString:function(e){return e&&e.name?e.name:e}}),t.annotator("addPlugin","Madison",{userId:user.id})})}]),angular.module("madisonApp.controllers").controller("UserNotificationsController",["$scope","$http","UserService",function(e,o,t){t.exists.then(function(){o.get("/api/user/"+e.user.id+"/notifications").success(function(o){e.notifications=o}).error(function(e){console.error("Error loading notifications: %o",e)})}),e.$watch("notifications",function(t,n){void 0!==n&&o.put("/api/user/"+e.user.id+"/notifications",{notifications:t}).success(function(e){}).error(function(e){console.error("Error updating notification settings: %o",e)})},!0)}]),angular.module("madisonApp.controllers").controller("UserPageController",["$scope","$http","$location",function(e,o,t){e.user={},e.meta="",e.docs=[],e.activities=[],e.verified=!1,e.init=function(){e.getUser()},e.getUser=function(){var n=t.absUrl(),a=n.match(/.*\/(\d+)$/);a=a[1],o.get("/api/user/"+a).success(function(o){e.user=angular.copy(o),e.meta=angular.copy(o.user_meta),angular.forEach(o.docs,function(o){e.docs.push(o)}),angular.forEach(o.comments,function(o){o.label="comment",e.activities.push(o)}),angular.forEach(o.annotations,function(o){o.label="annotation",e.activities.push(o)}),angular.forEach(e.user.user_meta,function(o){var t=!0;"verify"===o.meta_key&&"verified"===o.meta_value&&t&&(e.verified=!0,t=!1)})}).error(function(e){console.error("Unable to retrieve user: %o",e)})},e.showVerified=function(){return e.user.docs&&e.user.docs.length>0?!0:!1},e.activityOrder=function(e){return Date.parse(e.created_at)}}]),angular.module("madisonApp.dashboardControllers",[]),angular.module("madisonApp.dashboardControllers").controller("DashboardDocumentsController",["$scope","$http","$filter",function(e,o,t){e.docs=[],e.categories=[],e.sponsors=[],e.statuses=[],e.dates=[],e.dateSort="",e.select2="",e.docSort="created_at",e.reverse=!0,e.select2Config={multiple:!0,allowClear:!0,placeholder:"Filter documents by category, sponsor, or status"},e.dateSortConfig={allowClear:!0,placeholder:"Sort By Date"},o.get(_baseUrl+"/api/docs").success(function(o){e.parseDocs(o.results)}).error(function(e){console.error("Unable to get documents: %o",e)}),e.parseDocs=function(o){angular.forEach(o,function(o){e.docs.push(o),e.parseDocMeta(o.categories,"categories"),e.parseDocMeta(o.sponsor,"sponsors"),e.parseDocMeta(o.statuses,"statuses"),angular.forEach(o.dates,function(e){e.date=Date.parse(e.date)})})},e.parseDocMeta=function(o,n){void 0!==o&&0!==o.length&&angular.forEach(o,function(o){var a=t("getById")(e[n],o.id);if(null===a)switch(n){case"categories":e.categories.push(o);break;case"sponsors":e.sponsors.push(o);break;case"statuses":e.statuses.push(o);break;default:console.error("Unknown meta name: "+n)}})},e.docFilter=function(o){var t=!1;if(void 0!==e.select2&&""!==e.select2){var n=!0,a=e.select2.split("_"),r=a[0],s=parseInt(a[1],10);switch(r){case"category":angular.forEach(o.categories,function(e){+e.id===s&&n&&(t=!0,n=!1)});break;case"sponsor":angular.forEach(o.sponsor,function(e){+e.id===s&&n&&(t=!0,n=!1)});break;case"status":angular.forEach(o.statuses,function(e){+e.id===s&&n&&(t=!0,n=!1)})}}else t=!0;return t}}]),angular.module("madisonApp.dashboardControllers").controller("DashboardEditorController",["$scope","$http","$timeout","$location","$filter","growl",function(e,o,t,n,a,r){e.doc={},e.sponsor={},e.group={},e.status={},e.newdate={label:"",date:new Date},e.verifiedUsers=[],e.categories=[0],e.introtext="",e.suggestedCategories=[],e.suggestedStatuses=[],e.suggestedGroups=[],e.dates=[],e.init=function(){function o(e){return e.toLowerCase().replace(/[^a-zA-Z0-9\- ]/g,"").replace(/ +/g,"-")}var a=n.absUrl(),r=a.match(/.*\/(\d+)$/)[1],s=e.getDoc(r);e.getAllCategories(),e.getVerifiedUsers(),e.setSelectOptions();var i=!0,c=!0,u=!0,l=!0,d=!0,p=!0;s.then(function(){new Markdown.Editor(Markdown.getSanitizingConverter()).run(),$("#wmd-preview").css("overflow","scroll"),$("#wmd-preview").css("height",$("#wmd-input").height()+22),$("#wmd-input").scroll(function(){$("#wmd-preview").scrollTop($("#wmd-input").scrollTop())});var n=null;e.updateIntroText=function(o){n&&t.cancel(n),n=t(function(){e.saveIntroText(o)},3e3)},e.getDocStatus().then(function(){e.$watch("status",function(){c?t(function(){c=!1}):e.saveStatus()})}),e.getDocGroup().then(function(){e.$watch("group",function(){u?t(function(){u=!1}):e.saveGroup()})}),e.getDocCategories().then(function(){e.$watch("categories",function(){i?t(function(){i=!1}):e.saveCategories()})}),e.getIntroText(),e.getDocDates(),e.$watch("doc.title",function(){l?t(function(){l=!1}):e.saveTitle()}),e.$watch("doc.slug",function(){if(d)t(function(){d=!1});else{var n=e.doc.slug,a=o(n);n==a?e.saveSlug():(console.log("Invalid slug, reverting"),e.doc.slug=a)}});var a=null;e.$watch("doc.content.content",function(){p?t(function(){p=!1}):(a&&t.cancel(a),a=t(function(){e.saveContent()},5e3))})})},e.getShortUrl=function(){var t={username:"madison-robot",password:"MeV3MJJE",api:"http://opngv.us/yourls-api.php"},n=e.doc.slug,a=_baseUrl+"/docs/"+n;o({url:t.api,method:"JSONP",params:{callback:"JSON_CALLBACK",action:"shorturl",format:"jsonp",url:a,username:t.username,password:t.password}}).success(function(o){e.short_url=o.shorturl}).error(function(e){console.error(e),r.error("There was an error generating your short url.")})},e.setSelectOptions=function(){e.categoryOptions={placeholder:"Agrega categorías del documento",multiple:!0,simple_tags:!0,tokenSeparators:[","],tags:function(){return e.suggestedCategories},results:function(){return e.categories},initSelection:function(o,t){e.categories.splice(0,1),setTimeout(function(){var o=[];e.categories=$.unique(e.categories),angular.forEach(e.categories,function(e,t){o.push(angular.copy({id:t,text:e}))}),t(o)},2e3)}},e.statusOptions={placeholder:"Select Document Status",allowClear:!0,ajax:{url:_baseUrl+"/api/docs/statuses",dataType:"json",data:function(e,o){},results:function(e,o){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,text:e.label})}),{results:t}}},data:function(){return e.suggestedStatuses},results:function(){return e.status},createSearchChoice:function(e){return{id:e,text:e}},initSelection:function(o,t){t(e.status)}},e.groupOptions={placeholder:"Select Document Group",allowClear:!0,ajax:{url:_baseUrl+"/api/docs/groups",dataType:"json",data:function(e,o){},results:function(e,o){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,text:e.name})}),{results:t}}},data:function(){return e.suggestedGroups},results:function(){return e.group},createSearchChoice:function(e){return{id:e,text:e}},initSelection:function(o,t){t(e.group)}},e.sponsorOptions={placeholde:"Select Document Sponsor",allowClear:!0,ajax:{url:_baseUrl+"/api/user/sponsors/all",dataType:"json",data:function(){},results:function(e){var o=[];return e.success?(angular.forEach(e.sponsors,function(e){var t="";switch(e.sponsorType){case"group":t="[Group] "+e.name;break;case"user":t=e.fname+" "+e.lname+" - "+e.email}o.push({id:e.id,type:e.sponsorType,text:t})}),{results:o}):void alert(e.message)}},initSelection:function(o,t){t(e.sponsor)}}},e.statusChange=function(o){e.status=o},e.sponsorChange=function(o){e.sponsor=o},e.groupChange=function(o){e.group=o},e.categoriesChange=function(o){e.categories=o},e.getDoc=function(t){return o.get(_baseUrl+"/api/docs/"+t).success(function(o){e.doc=o,angular.forEach(o.categories,function(o){e.categories.push(angular.copy(o.name+" - "+o.kind))})})},e.saveTitle=function(){return o.post(_baseUrl+"/api/docs/"+e.doc.id+"/title",{title:e.doc.title}).success(function(e){console.log("Title saved successfully: %o",e)}).error(function(e){console.error("Error saving title for document:",e)})},e.saveSlug=function(){return o.post(_baseUrl+"/api/docs/"+e.doc.id+"/slug",{slug:e.doc.slug}).success(function(e){console.log(_baseUrl+"Slug sent: %o",e)}).error(function(e){console.error("Error saving slug for document:",e)})},e.saveContent=function(){return o.post(_baseUrl+"/api/docs/"+e.doc.id+"/content",{content:e.doc.content.content}).success(function(e){console.log("Content saved successfully: %o",e)}).error(function(e){console.error("Error saving content for document:",e)})},e.createDate=function(t){""!==e.newdate.label&&(e.newdate.date=a("date")(t,"short"),o.post(_baseUrl+"/api/docs/"+e.doc.id+"/dates",{date:e.newdate}).success(function(o){o.date=Date.parse(o.date),o.$changed=!1,e.dates.push(o),e.newdate={label:"",date:new Date}}).error(function(e){console.error("Unable to save date: %o",e)}))},e.deleteDate=function(t){o["delete"](_baseUrl+"/api/docs/"+e.doc.id+"/dates/"+t.id).success(function(){var o=e.dates.indexOf(t);e.dates.splice(o,1)}).error(function(){console.error("Unable to delete date: %o",t)})},e.saveDate=function(e){var t=angular.copy(e);return t.date=a("date")(t.date,"short"),o.put(_baseUrl+"/api/dates/"+e.id,{date:t}).success(function(o){e.$changed=!1,console.log("Date saved successfully: %o",o)}).error(function(o){console.error("Unable to save date: %o (%o)",e,o)})},e.getDocDates=function(){return o.get(_baseUrl+"/api/docs/"+e.doc.id+"/dates").success(function(o){angular.forEach(o,function(o,t){o.date=Date.parse(o.date),o.$changed=!1,e.dates.push(angular.copy(o)),e.$watch("dates["+t+"]",function(e,o){angular.equals(e,o)||void 0===e||(e.$changed=!0)},!0)})}).error(function(e){console.error("Error getting dates: %o",e)})},e.getVerifiedUsers=function(){return o.get(_baseUrl+"/api/user/verify").success(function(o){
angular.forEach(o,function(o){e.verifiedUsers.push(angular.copy(o.user))})}).error(function(e){console.error("Unable to get verified users: %o",e)})},e.getDocCategories=function(){return o.get(_baseUrl+"/api/docs/"+e.doc.id+"/categories").success(function(o){angular.forEach(o,function(o){e.categories.push(o.name+" - "+o.kind)})}).error(function(o){console.error("Unable to get categories for document %o: %o",e.doc,o)})},e.getIntroText=function(){return o.get(_baseUrl+"/api/docs/"+e.doc.id+"/introtext").success(function(o){e.introtext=o.meta_value}).error(function(o){console.error("Unable to get Intro Text for document %o: %o",e.doc,o)})},e.getDocSponsor=function(){return o.get(_baseUrl+"/api/docs/"+e.doc.id+"/sponsor").success(function(o){if(void 0===o.sponsorType)return void(e.sponsor=null);var t="";switch(o.sponsorType.toLowerCase()){case"group":t="[Group] "+o.name;break;case"user":t=o.fname+" "+o.lname+" - "+o.email}e.sponsor={id:o.id,type:o.sponsorType.toLowerCase(),text:t}}).error(function(e){console.error("Error getting document sponsor: %o",e)})},e.getDocGroup=function(){return o.get(_baseUrl+"/api/docs/"+e.doc.id+"/group").success(function(o){e.group=void 0===o.id?null:{id:o.id,text:o.name}}).error(function(e){console.error("Error getting document group: %o",e)})},e.getDocStatus=function(){return o.get(_baseUrl+"/api/docs/"+e.doc.id+"/status").success(function(o){e.status=void 0===o.id?null:{id:o.id,text:o.label}}).error(function(e){console.error("Error getting document status: %o",e)})},e.getAllStatuses=function(){o.get(_baseUrl+"/api/docs/statuses").success(function(o){angular.forEach(o,function(o){e.suggestedStatuses.push(o.label)})}).error(function(e){console.error("Unable to get document statuses: %o",e)})},e.getAllGroups=function(){o.get(_baseUrl+"/api/docs/groups").success(function(o){angular.forEach(o,function(o){e.suggestedGroups.push(o.label)})}).error(function(e){console.error("Unable to get document groups: %o",e)})},e.getAllCategories=function(){return o.get(_baseUrl+"/api/docs/categories").success(function(o){angular.forEach(o,function(o){e.suggestedCategories.push(o.name+" - "+o.kind)})}).error(function(e){console.error("Unable to get document categories: %o",e)})},e.saveStatus=function(){return o.post(_baseUrl+"/api/docs/"+e.doc.id+"/status",{status:e.status}).success(function(e){console.log("Status saved successfully: %o",e)}).error(function(e){console.error("Error saving status: %o",e)})},e.saveGroup=function(){return o.post(_baseUrl+"/api/docs/"+e.doc.id+"/group",{group:e.group}).success(function(e){console.log("Group saved successfully: %o",e)}).error(function(e){console.error("Error saving group: %o",e)})},e.saveSponsor=function(){return o.post(_baseUrl+"/api/docs/"+e.doc.id+"/sponsor",{sponsor:e.sponsor}).success(function(e){console.log("Sponsor saved successfully: %o",e)}).error(function(e){console.error("Error saving sponsor: %o",e)})},e.saveCategories=function(){return o.post(_baseUrl+"/api/docs/"+e.doc.id+"/categories",{categories:e.categories}).success(function(e){console.log("Categories saved successfully: %o",e)}).error(function(o){console.error("Error saving categories for document %o: %o \n %o",e.doc,e.categories,o)})},e.saveIntroText=function(t){return o.post(_baseUrl+"/api/docs/"+e.doc.id+"/introtext",{"intro-text":t}).success(function(e){console.log("Intro Text saved successfully: %o",e)}).error(function(o){console.error("Error saving intro text for document %o: %o",e.doc,e.introtext)})}}]),angular.module("madisonApp.dashboardControllers").controller("DashboardSettingsController",["$scope","$http",function(e,o){e.admins=[],e.getAdmins=function(){o.get("/api/user/admin").success(function(o){e.admins=o}).error(function(e){console.error(e)})},e.saveAdmin=function(e){e.saved=!1,o.post("/api/user/admin",{admin:e}).success(function(){e.saved=!0}).error(function(e){console.error(e)})},e.init=function(){e.getAdmins()}}]),angular.module("madisonApp.dashboardControllers").controller("DashbordVerifyController",["$scope","$http",function(e,o){e.requests=[],e.init=function(){e.getRequests()},e.getRequests=function(){o.get("/api/user/verify").success(function(o){e.requests=o}).error(function(e){console.error(e)})},e.update=function(e,t){o.post("/api/user/verify",{request:e,status:t}).success(function(){e.meta_value=t}).error(function(e){console.error(e)})}}]),angular.module("madisonApp.dashboardControllers").controller("DashboardVerifyGroupController",["$scope","$http",function(e,o){e.requests=[],e.init=function(){e.getRequests()},e.getRequests=function(){o.get("/api/groups/verify").success(function(o,t,n,a){e.requests=o}).error(function(e,o,t,n){console.error(e)})},e.update=function(e,t,n){o.post("/api/groups/verify",{request:e,status:t}).success(function(o){e.status=t}).error(function(e,o,t,n){console.error(e)})}}]),angular.module("madisonApp.dashboardControllers").controller("DashboardVerifyUserController",["$scope","$http",function(e,o){e.requests=[],e.init=function(){e.getRequests()},e.getRequests=function(){o.get("/api/user/independent/verify").success(function(o,t,n,a){e.requests=o}).error(function(e,o,t,n){console.error(e)})},e.update=function(e,t,n){o.post("/api/user/independent/verify",{request:e,status:t}).success(function(o){e.meta_value=t,location.reload()}).error(function(e,o,t,n){console.error(e)})}}]),angular.module("madisonApp.resources",[]),angular.module("madisonApp.resources").factory("Doc",["$resource",function(e){return e(_baseUrl+"/api/docs/:id",null,{query:{method:"GET",isArray:!1}})}]),angular.module("madisonApp.services",[]);var messageTimer;angular.module("madisonApp.services").factory("annotationService",["$rootScope","$sce",function(e,o){var t={},n=new Markdown.Converter;return t.annotations=[],t.setAnnotations=function(e){angular.forEach(e,function(e){e.html=o.trustAsHtml(n.makeHtml(e.text)),this.annotations.push(e)},this),this.broadcastUpdate()},t.addAnnotation=function(e){if(void 0===e.id)var t=window.setInterval(function(){this.addAnnotation(e),window.clearInterval(t)}.bind(this),500);else e.html=o.trustAsHtml(n.makeHtml(e.text)),this.annotations.push(e),this.broadcastUpdate()},t.broadcastUpdate=function(){e.$broadcast("annotationsUpdated")},t}]),angular.module("madisonApp.services").factory("createLoginPopup",["$document","$timeout",function(e,o){var t=e.find("body"),n=e.find("html"),a=function(){n.on("click.popup",function(){$(".popup").remove(),n.off("click.popup")})},r=function(e,o){var t=$(e);t.submit(function(e){e.preventDefault(),$.post(t.attr("action"),t.serialize(),function(e){if(e.errors&&Object.keys(e.errors).length){var n=$("<ul></ul>");angular.forEach(e.errors,function(e,o){n.append("<li>"+e+"</li>")}),t.find(".errors").html(n)}else o(e)})})};return function(e){console.log(e);var n=$('<div class="popup unauthed-popup"><p>Por favor regístrate.</p><input type="button" id="login" value="Ingresar" class="btn btn-primary"/><input type="button" id="signup" value="Registrarse" class="btn btn-primary" /></div>');n.on("click.popup",function(e){e.stopPropagation()}),$("#login",n).click(function(e){e.stopPropagation(),e.preventDefault(),$.get(_baseUrl+"/api/auth/login",{},function(e){e=$(e),r(e.find("form"),function(){$("html").trigger("click.popup"),location.reload(!1)}),n.html(e)})}),$("#signup",n).click(function(e){e.stopPropagation(),e.preventDefault(),$.get(_baseUrl+"/api/auth/signup",{},function(e){e=$(e),r(e.find("form"),function(e){$("html").trigger("click.popup"),alert(e.message)}),n.html(e)})}),t.append(n);var s={top:e.pageY-n.height(),left:e.clientX};n.css(s).css("position","absolute"),n.css("z-index","999"),o(function(){a()},50)}}]),angular.module("madisonApp.services").service("modalService",["$modal",function(e){var o={backdrop:!0,keyboard:!0,modalFade:!0,templateUrl:"/templates/modal.html"},t={closeButtonText:"Close",actionButtonText:!1,headerText:"Notice",bodyText:"Hmm... someone forgot the content here..."};this.showModal=function(e,o){return e||(e={}),e.backdrop=!0,this.show(e,o)},this.show=function(n,a){var r={},s={};return angular.extend(r,o,n),angular.extend(s,t,a),r.controller||(r.controller=function(e,o){e.modalOptions=s,e.modalOptions.ok=function(e){o.close(e)},e.modalOptions.close=function(e){o.dismiss("cancel")}}),e.open(r).result}}]),angular.module("madisonApp.services").factory("UserService",["$rootScope","$http",function(e,o){var t={};return t.user={},t.getUser=function(){t.exists=o.get(_baseUrl+"/api/user/current").success(function(o){t.user=o.user,e.$broadcast("userUpdated")})},t}]),angular.module("madisonApp.directives",[]),angular.module("madisonApp.directives").directive("activitySubComment",["growl","$anchorScroll","$timeout",function(e,o,t){return{restrict:"A",transclude:!0,templateUrl:"/templates/activity-sub-comment.html",compile:function(){return{post:function(n,a,r){var s=a.find(".subcomment-link").first(),i=window.location.origin+window.location.pathname+"#annsubcomment_"+r.subCommentId;$(s).attr("data-clipboard-text",i);var c=new ZeroClipboard(s);c.on("aftercopy",function(o){n.$apply(function(){e.success("Link copied to clipboard.")})}),t(function(){o()},0)}}}}}]),angular.module("madisonApp.directives").directive("annotationItem",["growl",function(e){return{restrict:"A",transclude:!0,templateUrl:"/templates/annotation-item.html",compile:function(){return{post:function(o,t,n){var a=t.find(".comment-link").first(),r=window.location.origin+window.location.pathname+"#"+n.activityItemLink;$(a).attr("data-clipboard-text",r);var s=new ZeroClipboard(a);s.on("aftercopy",function(t){o.$apply(function(){e.success("Link copied to clipboard.")})});var i=$(t).find(".activity-actions > span.ng-binding");i.on("click",function(){var e=$(this).closest(".activity-item"),o=e.css("background");e.css("background","#2276d7"),setTimeout(function(){e.css("background",o)},500)})}}}}}]),angular.module("madisonApp.directives").directive("commentItem",["growl",function(e){return{restrict:"A",transclude:!0,templateUrl:"/templates/comment-item.html",compile:function(){return{post:function(o,t,n){var a=t.find(".comment-link").first(),r=window.location.origin+window.location.pathname+"#"+n.activityItemLink;$(a).attr("data-clipboard-text",r);var s=new ZeroClipboard(a);s.on("aftercopy",function(t){o.$apply(function(){e.success("Link copied to clipboard.")})});var i=$(t).find(".activity-icon > span.ng-binding");i.on("click",function(){$(t).parent().effect("highlight",{color:"#2276d7"},1e3)})}}}}}]),angular.module("madisonApp.directives").directive("docComments",function(){return{restrict:"AECM",templateUrl:"/templates/doc-comments.html"}}),angular.module("madisonApp.directives").directive("docLink",["$http","$compile",function(e,o){return{restrict:"AECM",link:function(t,n,a){e.get("/api/docs/"+a.docId).success(function(e){var a='<a href="/docs/'+e.slug+'">'+e.title+"</a>",r=o(a)(t);n.replaceWith(r)}).error(function(e){console.error("Unable to retrieve document %o: %o",a.docId,e)})}}}]),angular.module("madisonApp.directives").directive("docListItem",function(){return{restrict:"A",templateUrl:_baseUrl+"-public/templates/doc-list-item.html"}}),angular.module("madisonApp.directives").directive("ngBlur",function(){return function(e,o,t){o.bind("blur",function(){e.$apply(t.ngBlur)})}}),angular.module("madisonApp.directives").directive("profileCompletionMessage",["$http",function(e){return{restrict:"A",templateUrl:"/templates/profile-completion-message.html",link:function(o){o.updateEmail=function(t,n){e.put(_baseUrl+"/api/user/"+o.user.id+"/edit/email",{email:t,password:n}).success(function(){o.user.email=t}).error(function(e){console.error("Error updating user email: %o",e),$(".update-email-error").html(e.messages[0].text)})}}}}]),angular.module("madisonApp.directives").directive("subcommentLink",["growl","$anchorScroll","$timeout",function(e,o,t){return{restrict:"A",template:'<span class="glyphicon glyphicon-link" title="Copy link to clipboard"></span>',compile:function(){return{post:function(n,a,r){var s=a,i=window.location.origin+window.location.pathname+"#subcomment_"+r.subCommentId;$(s).attr("data-clipboard-text",i);var c=new ZeroClipboard(s);c.on("aftercopy",function(o){n.$apply(function(){e.success("Link copied to clipboard.")})}),t(function(){o()},0);var u=$(a).closest(".activity-icon").children("span.ng-binding");u.on("click",function(){$(a).closest(".activity-reply").effect("highlight",{color:"#2276d7"},1e3)})}}}}}]),angular.module("madisonApp.filters",[]),angular.module("madisonApp.filters").filter("getById",function(){return function(e,o){var t=0,n=e.length;for(t;n>t;t++)if(+e[t].id===+o)return e[t];return null}}),angular.module("madisonApp.filters").filter("gravatar",function(){return function(e){var o="";return void 0!==e&&(o=CryptoJS.MD5(e.toLowerCase())),o}}),angular.module("madisonApp.filters").filter("parseDate",function(){return function(e){return Date.parse(e)}}),angular.module("madisonApp.filters").filter("toArray",function(){return function(e){return e instanceof Object?_.map(e,function(e,o){return e.$key=o,e}):e}}),window.getAnnotationService=function(){var e=angular.element($("html")),o=e.injector(),t=o.get("annotationService");return t},window.jQuery=window.$,$(function(){$.ajaxPrefilter(function(e,o,t){var n;return e.crossDomain||(n=$('meta[name="token"]').attr("content"),n&&t.setRequestHeader("X-CSRF-Token",n)),t})});var imports=["madisonApp.filters","madisonApp.services","madisonApp.resources","madisonApp.directives","madisonApp.controllers","madisonApp.dashboardControllers","ui","ui.bootstrap","ui.bootstrap.datetimepicker","ui.bootstrap.pagination","ui.select","ngAnimate","ngCookies","ngSanitize","angular-growl","ngResource","ngRoute","ipCookie","pascalprecht.translate"];moment.locale("es");var app=angular.module("madisonApp",imports);app.config(["growlProvider","$httpProvider",function(e,o){e.messagesKey("messages"),e.messageTextKey("text"),e.messageSeverityKey("severity"),e.onlyUniqueMessages(!0),e.globalTimeToLive(5e3)}]),app.config(function(e){e.html5Mode(!0)}),app.config(["$translateProvider",function(e){e.translations("en",{POSTED:"Posted",UPDATED:"Updated"}),e.translations("es",{POSTED:"Publicación",UPDATED:"Última actualización"}),e.preferredLanguage("es")}]),window.console=window.console||{},window.console.log=window.console.log||function(){};